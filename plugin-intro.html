
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introduction to Writing Plugins &#8212; Porcupine API 0.77.0+git.7559bfc documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="porcupine — The top level Porcupine package" href="porcupine.html" />
    <link rel="prev" title="Welcome to Porcupine’s plugin API documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="introduction-to-writing-plugins">
<span id="plugin-intro"></span><h1>Introduction to Writing Plugins<a class="headerlink" href="#introduction-to-writing-plugins" title="Permalink to this headline">¶</a></h1>
<p>Porcupine is written in Python 3, and it can be extended a lot by writing
plugins for it in Python 3. Writing plugins is easy, but this tutorial and
Porcupine’s API documentation assume
<a class="reference external" href="https://github.com/Akuli/tkinter-tutorial">basic tkinter skills</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are an experienced tkinter user and you don’t want to read this
whole tutorial, read at least
<a class="reference internal" href="#plugin-intro-pitfalls"><span class="std std-ref">the pitfall section</span></a>.</p>
</div>
<div class="section" id="where-are-the-plugins">
<h2>Where are the plugins?<a class="headerlink" href="#where-are-the-plugins" title="Permalink to this headline">¶</a></h2>
<p>Porcupine searches for plugins in two places. The plugins that come with
Porcupine are installed along with it, but Porcupine also creates a user-wide
<code class="docutils literal notranslate"><span class="pre">plugins</span></code> folder in its config directory. You can check where it is using
Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">porcupine.plugins</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">porcupine</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">/home/akuli/.config/porcupine/plugins</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">--print-plugindir</span></code> as shown <a class="reference external" href="https://github.com/Akuli/porcupine/tree/master/more_plugins/">here</a>.</p>
<p>Of course, your plugins are probably not in <code class="docutils literal notranslate"><span class="pre">/home/akuli/.config/porcupine/plugins</span></code>,
so you need to run the above commands yourself to find out where your plugins
should go. Rest of this tutorial calls this place <strong>the plugin directory</strong>.</p>
<p>Your plugin directory is empty by default. The plugins that come with Porcupine
are installed in a different place:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">porcupine</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">/home/akuli/.local/lib/python3.7/site-packages/porcupine/plugins</span>
</pre></div>
</div>
</div>
<div class="section" id="hello-world">
<h2>Hello World!<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p>Create a <code class="docutils literal notranslate"><span class="pre">hello.py</span></code> to your plugin directory, and add this code to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">messagebox</span>
<span class="kn">from</span> <span class="nn">porcupine</span> <span class="kn">import</span> <span class="n">menubar</span>

<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello World!&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
    <span class="n">menubar</span><span class="o">.</span><span class="n">get_menu</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
<p>Restart Porcupine. You should see a new <em>Hello</em> menu in the menubar with a
<em>Hello World</em> button in it. Clicking that button runs the <code class="docutils literal notranslate"><span class="pre">hello()</span></code>
function.</p>
<p>Some details:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">menubar.get_menu(&quot;Hello&quot;)</span></code> creates a <code class="xref py py-class docutils literal notranslate"><span class="pre">tkinter.Menu</span></code> widget labelled
<em>Hello</em> into the menubar and returns it. If there was already a menu labelled
<em>Hello</em> in the menubar, then that would be returned instead. To create
submenus instead, you can give a slash-separated string, such as
<code class="docutils literal notranslate"><span class="pre">&quot;Tools/Python&quot;</span></code> for submenu menu named <em>Python</em> inside the <em>Tools</em> menu.
See <a class="reference internal" href="menubar.html#module-porcupine.menubar" title="porcupine.menubar"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.menubar</span></code></a> for more details.</p></li>
<li><p>Usually plugins are files, but directories with an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> in them
work as well.</p></li>
<li><p>Plugins can be imported like <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">porcupine.plugins.hello</span></code>.
That’s how Porcupine loads them.</p></li>
<li><p>File and directory names starting with <code class="docutils literal notranslate"><span class="pre">_</span></code> are ignored.</p></li>
<li><p>Each plugin must define a <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function. If your plugin is a package,
the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function must be exposed in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>. Porcupine calls
this function on startup before opening any tabs.</p></li>
<li><p>Plugins are imported in an arbitary order, but you can control the order that
the setup functions are called in. For example, you could add this code to
<code class="docutils literal notranslate"><span class="pre">hello.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setup_before</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tabs2spaces&#39;</span><span class="p">]</span>
<span class="n">setup_after</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fullscreen&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now our <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function is guaranteed to be called before setting up
<a class="reference external" href="https://github.com/Akuli/porcupine/tree/master/porcupine/plugins/tabs2spaces.py">tabs2spaces.py</a>, and
<a class="reference external" href="https://github.com/Akuli/porcupine/tree/master/porcupine/plugins/fullscreen.py">fullscreen.py</a>’s <code class="docutils literal notranslate"><span class="pre">setup()</span></code> is
always called before our <code class="docutils literal notranslate"><span class="pre">setup()</span></code>.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="a-step-back">
<h2>A Step Back<a class="headerlink" href="#a-step-back" title="Permalink to this headline">¶</a></h2>
<p>Porcupine’s plugin API is powerful, and many of Porcupine’s features are
implemented as plugins. They come with Porcupine (see <a class="reference internal" href="#where-are-the-plugins">Where are the plugins?</a>
above), but you can also <a class="reference external" href="https://github.com/Akuli/porcupine/tree/master/porcupine/plugins">read them on GitHub</a>.</p>
<p>This tutorial is all about writing <em>more</em> plugins, but we’ll start by running
Porcupine with <em>no</em> plugins at all just to get an idea of how much can be done
with plugins. Open a command prompt or terminal and run this command on it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">porcu</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">plugins</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">porcu</span></code> command doesn’t work you can use <code class="docutils literal notranslate"><span class="pre">pyw</span> <span class="pre">-m</span> <span class="pre">porcupine</span></code> or
<code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">porcupine</span></code> instead of <code class="docutils literal notranslate"><span class="pre">porcu</span></code> as shown in
<a class="reference external" href="https://github.com/Akuli/porcupine#installing-porcupine">Porcupine’s README</a>.</p>
<p>This will run Porcupine without any plugins, and it’s a window with only the
menubar in it. You can still create and open files though.</p>
</div>
<div class="section" id="porcupine-s-widgets">
<h2>Porcupine’s Widgets<a class="headerlink" href="#porcupine-s-widgets" title="Permalink to this headline">¶</a></h2>
<p>Here are the widgets that Porcupine itself creates without any plugins:</p>
<img alt="_images/no-plugins.png" src="_images/no-plugins.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="simple">
<dt>❶ Main Window</dt><dd><p>Everything is inside this widget. Usually it’s a <code class="docutils literal notranslate"><span class="pre">tkinter.Tk</span></code> root window,
but it might be a <code class="docutils literal notranslate"><span class="pre">Toplevel</span></code> widget in a future version of Porcupine. You
can access this widget with <a class="reference internal" href="porcupine.html#porcupine.get_main_window" title="porcupine.get_main_window"><code class="xref py py-func docutils literal notranslate"><span class="pre">porcupine.get_main_window()</span></code></a>.</p>
</dd>
<dt>❷ Menu Bar</dt><dd><p>You can access this widget with <a class="reference internal" href="menubar.html#porcupine.menubar.get_menu" title="porcupine.menubar.get_menu"><code class="xref py py-func docutils literal notranslate"><span class="pre">porcupine.menubar.get_menu()</span></code></a>.</p>
</dd>
<dt>❸ Tab Manager</dt><dd><p>This widget contains tabs (as in browser tabs, not <code class="docutils literal notranslate"><span class="pre">\t</span></code> characters), and
<a class="reference external" href="https://github.com/Akuli/porcupine/tree/master/porcupine/plugins/welcome.py">the welcome plugin</a> displays a
welcome message in it when there are no tabs. This widget is a
<a class="reference internal" href="tabs.html#porcupine.tabs.TabManager" title="porcupine.tabs.TabManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">porcupine.tabs.TabManager</span></code></a> and can be accessed with
<a class="reference internal" href="porcupine.html#porcupine.get_tab_manager" title="porcupine.get_tab_manager"><code class="xref py py-func docutils literal notranslate"><span class="pre">porcupine.get_tab_manager()</span></code></a>.</p>
</dd>
<dt>❸ A Tab</dt><dd><p>Tabs are <a class="reference internal" href="tabs.html#porcupine.tabs.Tab" title="porcupine.tabs.Tab"><code class="xref py py-class docutils literal notranslate"><span class="pre">porcupine.tabs.Tab</span></code></a> widgets, and you can access them with
the tab manager’s <a class="reference internal" href="tabs.html#porcupine.tabs.TabManager.tabs" title="porcupine.tabs.TabManager.tabs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tabs</span></code></a> attribute.
This tab is a <a class="reference internal" href="tabs.html#porcupine.tabs.FileTab" title="porcupine.tabs.FileTab"><code class="xref py py-class docutils literal notranslate"><span class="pre">porcupine.tabs.FileTab</span></code></a> because it represents a new
file, but you can also create custom tabs that contain any tkinter widgets.
See <a class="reference internal" href="tabs.html#module-porcupine.tabs" title="porcupine.tabs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.tabs</span></code></a> for more documentation about tabs.</p>
</dd>
</dl>
</div>
<div class="section" id="virtual-events">
<span id="id1"></span><h2>Virtual Events<a class="headerlink" href="#virtual-events" title="Permalink to this headline">¶</a></h2>
<p>I added this short section here because not all tkinter users have seen virtual
events before. For example, code like this prints <code class="docutils literal notranslate"><span class="pre">hi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_hi</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">)</span>

<span class="n">some_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;PrintHi&gt;&gt;&#39;</span><span class="p">,</span> <span class="n">print_hi</span><span class="p">)</span>
<span class="n">some_widget</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;PrintHi&gt;&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that virtual event names must be between <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>, just <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are not enough. Porcupine generates some virtual events, and you can bind
to them in plugins.</p>
<p>Be careful to spell virtual event names correctly. We didn’t really define the
<code class="docutils literal notranslate"><span class="pre">&lt;&lt;PrintHi&gt;&gt;</span></code> event anywhere, so if we spell <code class="docutils literal notranslate"><span class="pre">&lt;PrintHi&gt;&gt;</span></code> correctly in one
place and misspell it like <code class="docutils literal notranslate"><span class="pre">&lt;&lt;PirntHi&gt;&gt;</span></code> somewhere else we don’t get any
errors.</p>
</div>
<div class="section" id="potential-pitfalls">
<span id="plugin-intro-pitfalls"></span><h2>Potential Pitfalls<a class="headerlink" href="#potential-pitfalls" title="Permalink to this headline">¶</a></h2>
<p>Most tkinter things work in Porcupine like you would expect them to work, but
there are a few things that you should be aware of.</p>
<div class="section" id="use-add-true">
<h3>Use add=True<a class="headerlink" href="#use-add-true" title="Permalink to this headline">¶</a></h3>
<p>When you bind something that another plugin might need to bind as well, use the
<code class="docutils literal notranslate"><span class="pre">add=True</span></code> argument to <code class="docutils literal notranslate"><span class="pre">bind()</span></code>. For example, let’s say you have something
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">callback1</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lol&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">callback2</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wut&quot;</span><span class="p">)</span>

<span class="n">some_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="n">callback1</span><span class="p">)</span>
<span class="n">some_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="n">callback2</span><span class="p">)</span>    <span class="c1"># now clicking the widget doesn&#39;t print lol</span>
</pre></div>
</div>
<p><strong>This code is bad!</strong> Now <code class="docutils literal notranslate"><span class="pre">callback1</span></code> doesn’t run at all because binding
<code class="docutils literal notranslate"><span class="pre">callback2</span></code> discarded the old binding. Everything would be fine
if we had done this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="n">callback1</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">some_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="n">callback2</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># now they&#39;re both bound</span>
</pre></div>
</div>
<p>Unfortunately tkinter’s <code class="docutils literal notranslate"><span class="pre">unbind()</span></code> method is stupid and it unbinds
everything, regardless of the second argument passed into it (see
<a class="reference external" href="https://github.com/python/cpython/blob/dff9b5f9d62a/Lib/tkinter/__init__.py#L1249">the source code</a>).
If you need to bind and unbind something use
<code class="xref py py-func docutils literal notranslate"><span class="pre">porcupine.utils.temporary_bind()</span></code>, and let me know that you needed it so I
won’t delete it.</p>
</div>
<div class="section" id="binding-key-presses">
<h3>Binding Key Presses<a class="headerlink" href="#binding-key-presses" title="Permalink to this headline">¶</a></h3>
<p>If you want to bind a key press <strong>globally</strong> you should use
<code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.actions</span></code> in most cases, but you can also bind on the main
window, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_hello</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;break&#39;</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
    <span class="n">porcupine</span><span class="o">.</span><span class="n">get_main_window</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Control-g&gt;&#39;</span><span class="p">,</span> <span class="n">print_hello</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+G</span></code> in <em>any</em> Porcupine widget runs <code class="docutils literal notranslate"><span class="pre">print_hello</span></code>.</p>
<p>Note that the binding returns <code class="docutils literal notranslate"><span class="pre">'break'</span></code>. This way, if tkinter does something
by default when <code class="docutils literal notranslate"><span class="pre">Ctrl+G</span></code> is pressed, it will not do it now. You can also
<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">'break'</span></code> from other callbacks to indicate whether other plugins
should handle that event (see <a class="reference internal" href="#shift-tab">Shift-Tab</a> below).</p>
<p>Of course, you can also create <strong>non-global</strong> bindings normally with the
<code class="docutils literal notranslate"><span class="pre">bind()</span></code> method of any other widget.</p>
</div>
<div class="section" id="shift-tab">
<h3>Shift-Tab<a class="headerlink" href="#shift-tab" title="Permalink to this headline">¶</a></h3>
<p>A common thing to do in plugins is to bind something on the text widget of
every <a class="reference internal" href="tabs.html#porcupine.tabs.FileTab" title="porcupine.tabs.FileTab"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileTab</span></code></a>. The callbacks may
<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">'break'</span></code> to prevent other plugins from handling the same event.</p>
<p>For example, if you’re implementing an autocompleter plugin you might be
tempted to write this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">porcupine</span> <span class="kn">import</span> <span class="n">tabs</span>

<span class="k">def</span> <span class="nf">on_tab</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">we_can_complete</span><span class="p">():</span>
        <span class="n">complete_next_alternative</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_shift_tab</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">we_can_complete</span><span class="p">():</span>
        <span class="n">complete_previous_alternative</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_new_tab</span><span class="p">(</span><span class="n">tab</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">tabs</span><span class="o">.</span><span class="n">FileTab</span><span class="p">):</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Tab&gt;&#39;</span><span class="p">,</span> <span class="n">on_tab</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;Shift-Tab&gt;&#39;</span><span class="p">,</span> <span class="n">on_tab</span><span class="p">)</span>

<span class="c1"># here&#39;s some code that runs on_new_tab() when a new tab is added</span>
</pre></div>
</div>
<p><strong>This code is also bad!</strong> First of all, it’s not using <code class="docutils literal notranslate"><span class="pre">add=True</span></code>, but
<code class="docutils literal notranslate"><span class="pre">&lt;Shift-Tab&gt;</span></code> is also limited to Windows and OSX; it doesn’t work at all on
Linux. What’s more, any other plugins that handle Tab presses would get
notified of those tab presses that this plugin was able to autocomplete with
(except that they might not work at all because <code class="docutils literal notranslate"><span class="pre">add=True</span></code> wasn’t used).</p>
<p>Let’s fix this crap with <code class="docutils literal notranslate"><span class="pre">add=True</span></code>, <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">'break'</span></code> and
<a class="reference internal" href="utils.html#porcupine.utils.bind_tab_key" title="porcupine.utils.bind_tab_key"><code class="xref py py-func docutils literal notranslate"><span class="pre">porcupine.utils.bind_tab_key()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">porcupine</span> <span class="kn">import</span> <span class="n">tabs</span><span class="p">,</span> <span class="n">utils</span>

<span class="c1"># this plugin handles all tab presses and returns &#39;break&#39; from them, you</span>
<span class="c1"># need this if you bind &lt;Tab&gt; on the text widget</span>
<span class="n">setup_before</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tabs2spaces&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">on_tab</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">shift_pressed</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">we_can_complete</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">shift_pressed</span><span class="p">:</span>
            <span class="n">complete_previous_alternative</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">complete_next_alternative</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;break&#39;</span>    <span class="c1"># don&#39;t notify other plugins about this event</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>    <span class="c1"># let other plugins do whatever they want to</span>

<span class="k">def</span> <span class="nf">on_new_tab</span><span class="p">(</span><span class="n">tab</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">tabs</span><span class="o">.</span><span class="n">FileTab</span><span class="p">):</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">bind_tab_key</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">on_tab</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/Akuli/porcupine/tree/master/porcupine/plugins/indent_block.py">porcupine/plugins/indent_block.py</a> for a complete example plugin.</p>
</div>
</div>
<div class="section" id="cleaning-up-bindings">
<h2>Cleaning Up Bindings<a class="headerlink" href="#cleaning-up-bindings" title="Permalink to this headline">¶</a></h2>
<p>A binding like <code class="docutils literal notranslate"><span class="pre">widget.bind('&lt;Foo&gt;',</span> <span class="pre">callback,</span> <span class="pre">...)</span></code> creates a Tcl command that runs
the Python <code class="docutils literal notranslate"><span class="pre">callback</span></code> function. By default, those Tcl commands are cleaned up when
<code class="docutils literal notranslate"><span class="pre">widget</span></code> is destroyed. This is great for most bindings, because typically you want a
binding to be alive until the related widget is destroyed.</p>
<p>Avoid creating lots of bindings without cleaning them up properly. In particular, avoid
writing code that creates new bindings every time a user does something, but doesn’t clean
up the old bindings when it does that.</p>
<p>For example, this code is <strong>bad</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">callback_that_runs_when_user_does_something</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">list_of_tag_names</span><span class="p">:</span>
        <span class="n">text_widget</span><span class="o">.</span><span class="n">tag_delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">list_of_tag_names</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">thing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">something</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;foo_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">text_widget</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="n">list_of_tag_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">something</span></code> is typically a sequence of 30 things and this callback runs 500 times for
the same <code class="docutils literal notranslate"><span class="pre">text_widget</span></code>, then this creates 1500 new Tcl commands for the bindings, and
none of them get cleaned up before <code class="docutils literal notranslate"><span class="pre">text_widget</span></code> is destroyed. As a quick fix, you can
add some cleanup code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bindings</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">callback_that_runs_when_user_does_something</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">for</span> <span class="n">binding</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">:</span>
        <span class="n">text_widget</span><span class="o">.</span><span class="n">deletecommand</span><span class="p">(</span><span class="n">binding</span><span class="p">)</span>
    <span class="n">bindings</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">thing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">something</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="n">tcl_command</span> <span class="o">=</span> <span class="n">text_widget</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
        <span class="n">bindings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tcl_command</span><span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Now the bindings don’t “pile up”, and old bindings get cleaned up whenever new bindings
get added.</p>
<p>A “better” fix is to avoid running the same bind code multiple times.
For example, you could create one tag that includes all the bindings, and then apply two
tags in the loop, the <code class="docutils literal notranslate"><span class="pre">f'foo_{index}'</span></code> tag and the tag that does the bindings.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Porcupine API</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction to Writing Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#where-are-the-plugins">Where are the plugins?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hello-world">Hello World!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-step-back">A Step Back</a></li>
<li class="toctree-l2"><a class="reference internal" href="#porcupine-s-widgets">Porcupine’s Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtual-events">Virtual Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#potential-pitfalls">Potential Pitfalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cleaning-up-bindings">Cleaning Up Bindings</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="porcupine.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine</span></code> — The top level Porcupine package</a></li>
<li class="toctree-l1"><a class="reference internal" href="menubar.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.menubar</span></code> — The menu bar at the top of the Porcupine window</a></li>
<li class="toctree-l1"><a class="reference internal" href="tabs.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.tabs</span></code> — The tab manager and tabs in it</a></li>
<li class="toctree-l1"><a class="reference internal" href="textwidget.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.textwidget</span></code> — Things for <code class="docutils literal notranslate"><span class="pre">tkinter.Text</span></code> widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="images.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.images</span></code> — Load images that come with Porcupine</a></li>
<li class="toctree-l1"><a class="reference internal" href="dirs.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.dirs</span></code> — Paths to Porcupine’s files</a></li>
<li class="toctree-l1"><a class="reference internal" href="filetypes.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.filetypes</span></code> — Low-level access to <code class="docutils literal notranslate"><span class="pre">filetypes.toml</span></code> stuff</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.settings</span></code> — Porcupine’s setting manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="pluginloader.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.pluginloader</span></code> — The module that loads plugins on startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine.utils</span></code> — Handy utility functions and classes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to Porcupine’s plugin API documentation!</a></li>
      <li>Next: <a href="porcupine.html" title="next chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">porcupine</span></code> — The top level Porcupine package</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Akuli.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/plugin-intro.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>